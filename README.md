## Salesync Backend
### ë””ë ‰í„°ë¦¬ êµ¬ì¡°
<details>
<summary>ë””ë ‰í„°ë¦¬ êµ¬ì¡°</summary>
<div markdown="1">

```
ğŸ“¦backend
 â”£ ğŸ“‚.github
 â”ƒ â”£ ğŸ“‚ISSUE_TEMPLATE
 â”ƒ â”ƒ â”£ ğŸ“œâœ…-feature-request.md
 â”ƒ â”ƒ â”— ğŸ“œğŸ-bug-report.md
 â”ƒ â”£ ğŸ“‚workflows
 â”ƒ â”ƒ â”£ ğŸ“œbff.yaml
 â”ƒ â”ƒ â”£ ğŸ“œconsulting-service.yml
 â”ƒ â”ƒ â”£ ğŸ“œdash-service.yml
 â”ƒ â”ƒ â”£ ğŸ“œdesc.txt
 â”ƒ â”ƒ â”£ ğŸ“œitem-service.yml
 â”ƒ â”ƒ â”£ ğŸ“œmodels.yml
 â”ƒ â”ƒ â”£ ğŸ“œorder-service.yml
 â”ƒ â”ƒ â”£ ğŸ“œsale-service.yml
 â”ƒ â”ƒ â”— ğŸ“œstore-service.yml
 â”ƒ â”£ ğŸ“œCODEOWNERS
 â”ƒ â”— ğŸ“œPULL_REQUEST_TEMPLATE
 â”£ ğŸ“‚bff
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œbff.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œmain.py
 â”ƒ â”ƒ â”— ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œdevelopment.py
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“‚consulting_service
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œconsulting.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œmain.py
 â”ƒ â”ƒ â”£ ğŸ“‚kafka
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œconsumer.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œproducer.py
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œmodels.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œdevelopment.py
 â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“œapp.sh
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“‚dashboard_service
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œdashboard.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œmain.py
 â”ƒ â”ƒ â”£ ğŸ“‚kafka
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œconsumer.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œproducer.py
 â”ƒ â”ƒ â”— ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œdevelopment.py
 â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“‚item_service
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œcategories.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œitems.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œmain.py
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œmodels.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”£ ğŸ“œdevelopment.py
 â”ƒ â”ƒ â”— ğŸ“œproduction.py
 â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“œapp.sh
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“‚order_service
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œmain.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œorders.py
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œmodels.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”£ ğŸ“œdevelopment.py
 â”ƒ â”ƒ â”— ğŸ“œproduction.py
 â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“œapp.sh
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“‚sale_service
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œmain.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œsales.py
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œmodels.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”£ ğŸ“œdevelopment.py
 â”ƒ â”ƒ â”— ğŸ“œproduction.py
 â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“œapp.sh
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“‚store_service
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œmain.py
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œstores.py
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”— ğŸ“œmodels.py
 â”ƒ â”£ ğŸ“‚config
 â”ƒ â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”ƒ â”£ ğŸ“œdevelopment.py
 â”ƒ â”ƒ â”— ğŸ“œproduction.py
 â”ƒ â”£ ğŸ“‚test
 â”ƒ â”ƒ â”£ ğŸ“œfixtures.py
 â”ƒ â”ƒ â”£ ğŸ“œhook.py
 â”ƒ â”ƒ â”— ğŸ“œtest_api.py
 â”ƒ â”£ ğŸ“œ__init__.py
 â”ƒ â”£ ğŸ“œapp.sh
 â”ƒ â”— ğŸ“œrequirements.txt
 â”£ ğŸ“œ.gitignore
 â”£ ğŸ“œDockerfile-bff
 â”£ ğŸ“œDockerfile-consulting
 â”£ ğŸ“œDockerfile-dash
 â”£ ğŸ“œDockerfile-item
 â”£ ğŸ“œDockerfile-order
 â”£ ğŸ“œDockerfile-sale
 â”£ ğŸ“œDockerfile-store
 â”£ ğŸ“œREADME.md
 â”— ğŸ“œ__init__.py
```

</details>

- .github: GitHub ì›Œí¬í”Œë¡œìš° ë° í˜„ì—… ì»¨ë²¤ì…˜
- *_service: ì„œë¹„ìŠ¤ ë‹¨ìœ„ë¡œ ë…¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬
    - /app/api: ì„œë²„ ì½”ë“œ
    - /app/models.py: orm ëª¨ë¸
    - /app/config: config íŒŒì¼
    - /app/kafka: kafka ì„¤ì •
        - producer, consumer ë° í•„ìš” í•¨ìˆ˜ ì •ì˜
    - app.sh: ë¹Œë“œ ì‹œ ì‹¤í–‰ íŒŒì¼
- Dockerfile-*: í•´ë‹¹ ì„œë¹„ìŠ¤ Dockerfile

## ê¸°ìˆ  ìŠ¤íƒ
![Static Badge](https://img.shields.io/badge/flask-%23000000?style=flat&logo=flask&logoColor=white)
![Static Badge](https://img.shields.io/badge/SQLAlchemy-%23D71F00?style=flat&logo=sqlalchemy&logoColor=white)
![Static Badge](https://img.shields.io/badge/PostgreSQL-%234169E1?style=flat&logo=postgresql&logoColor=white)
![Static Badge](https://img.shields.io/badge/Apache%20Kafka-%23231F20?style=flat&logo=apachekafka&logoColor=white)

![Static Badge](https://img.shields.io/badge/Docker-%232496ED?style=flat&logo=docker&logoColor=white)
![Static Badge](https://img.shields.io/badge/Amazon%20RDS-%23527FFF?style=flat&logo=amazonrds&logoColor=white)
![Static Badge](https://img.shields.io/badge/Amazon%20EKS-%23FF9900?style=flat&logo=amazoneks&logoColor=white)
![Static Badge](https://img.shields.io/badge/Amazon%20DynamoDB-%234053D6?style=flat&logo=amazondynamodb&logoColor=white)
![Static Badge](https://img.shields.io/badge/Amazon%20S3-%23569A31?style=flat&logo=amazons3&logoColor=white)

![Static Badge](https://img.shields.io/badge/Terraform-%23844FBA?style=flat&logo=terraform&logoColor=white)

![Static Badge](https://img.shields.io/badge/GitHub%20Actions-%232088FF?style=flat&logo=githubactions&logoColor=white)
![Static Badge](https://img.shields.io/badge/ArgoCD-%23EF7B4D?style=flat&logo=argo&logoColor=white)

![Static Badge](https://img.shields.io/badge/Elasticsearch-%23005571?style=flat&logo=elasticsearch&logoColor=white)
![Static Badge](https://img.shields.io/badge/Fluentd-%230E83C8?style=flat&logo=fluentd&logoColor=white)
![Static Badge](https://img.shields.io/badge/Kibana-%23005571?style=flat&logo=kibana&logoColor=white)

![Static Badge](https://img.shields.io/badge/Prometheus-%23E6522C?style=flat&logo=prometheus&logoColor=white)
![Static Badge](https://img.shields.io/badge/Grafana-%23F46800?style=flat&logo=grafana&logoColor=white)

## ëª¨ë…¸ë ˆí¬
MSA ì•„í‚¤í…ì²˜ ì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ì˜ ë ˆí¬ì—ì„œ ê´€ë¦¬í•œë‹¤.
ê° ì„œë¹„ìŠ¤ë³„ í´ë”ì—ì„œ ì‘ì—… í›„ ë³€ê²½ ì‚¬í•­ì´ ê°ì§€ë˜ëŠ” ê²½ìš° ìë™ buildí›„ ECRì— íƒœê·¸ ë³€ê²½í•œë‹¤. ë³€ê²½ëœ íƒœê·¸ë¥¼ ArgoCDê°€ ê°ì§€í•œ í›„ ê° serviceì™€ deployë¡œ ë°°í¬í•œë‹¤.
<img src="sources/argocd.png">

## Services
### Store Service

- ë¡œê·¸ì¸
- íšŒì› ê°€ì… ë° ë§¤ì¥ ì •ë³´ ë“±ë¥µ
- ë§¤ì¥ ì •ë³´ ì¡°íšŒ ë° ìˆ˜ì •
- ë¡œê·¸ì¸ ì‹œ JWT í† í° ë°œê¸‰

<details>
<summary> Store ì„œë¹„ìŠ¤ API ëª…ì„¸ì„œ</summary>
<div markdown="1">
    <img src="sources/store.png">
</div>
</details>

### Item Service
- ì¹´í…Œê³ ë¦¬ ë° ì•„ì´í…œ ë“±ë¡
- ì¹´í…Œê³ ë¦¬ ë° ì•„ì´í…œ ì¡°íšŒ
- ì¹´í…Œê³ ë¦¬ ë° ì•„ì´í…œ ìˆ˜ì •
- ì¹´í…Œê³ ë¦¬ ë° ì•„ì´í…œ ì‚­ì œ

<details>
<summary> Item ì„œë¹„ìŠ¤ API ëª…ì„¸ì„œ</summary>
<div markdown="1">
    <img src="sources/item.png">
</div>
</details>

### Order Service
- ì£¼ë¬¸ ë“±ë¡ ë° ìˆ˜ì •
- ë¯¸ê²°ì œ í…Œì´ë¸” ì¡°íšŒ
- ì£¼ë¬¸ ì „ì²´ ì·¨ì†Œ
- ì¼ë³„ í˜¹ì€ ê¸°ê°„ë³„ ì£¼ë¬¸ëŸ‰ ì¡°íšŒ
- Item ì„œë¹„ìŠ¤ì™€ ë‚´ë¶€ í†µì‹ 

<details>
<summary> Order ì„œë¹„ìŠ¤ API ëª…ì„¸ì„œ</summary>
<div markdown="1">
    <img src="sources/order.png">
</div>
</details>

### Sale Service
- ì „ì²´ ë§¤ì¶œ ì¡°íšŒ
- ì¼ë³„ ë° ê¸°ê°„ë³„ ë§¤ì¶œ ì¡°íšŒ
- Order ì„œë¹„ìŠ¤ì™€ ë‚´ë¶€ í†µì‹ 

<details>
<summary> Sale ì„œë¹„ìŠ¤ API ëª…ì„¸ì„œ</summary>
<div markdown="1">
    <img src="sources/sale.png">
</div>
</details>

### Dashboard Service
- ì•„ì´í…œ ì›ê°€ ì…ë ¥ ë° ìˆ˜ì •
- ê¸°ê°„ë³„ ì „ì²´ ë§¤ì¶œ ë° ìˆœì´ìµ ì¡°íšŒ
- ì»¨ì„¤íŒ… ì¡°íšŒ
- Sale, Order, Item ì„œë¹„ìŠ¤ì™€ ë‚´ë¶€ í†µì‹ 
- Consulting ì„œë¹„ìŠ¤ì˜ Kafka Producerê°€ ì†¡ì‹ í•œ ì´ë²¤íŠ¸ ìˆ˜ì‹ í•˜ëŠ” Kafka Consumer
- í•˜ë£¨ ë§¤ì¶œ ì •ì‚° ë¬¸ì ì „ì†¡

<details>
<summary> Dashboard ì„œë¹„ìŠ¤ API ëª…ì„¸ì„œ</summary>
<div markdown="1">
    <img src="sources/dashboard.png">
</div>
</details>

### Consulting Service
- ì»¨ì„¤íŒ…
- Dashboard ì„œë¹„ìŠ¤ì™€ ë‚´ë¶€ í†µì‹ 
- ë¹„ë™ê¸° ì²˜ë¦¬ í›„ ê²°ê³¼ê°’ ì´ë²¤íŠ¸ ë²„ìŠ¤ë¡œ ì†¡ì‹ í•˜ëŠ” Kafka Producer
- OpenAI API ì‚¬ìš©ì„ ìœ„í•œ ë¹„ë™ê¸° ì‹¤í–‰

<details>
<summary> Consulting ì„œë¹„ìŠ¤ API ëª…ì„¸ì„œ</summary>
<div markdown="1">
    <img src="sources/consulting.png">
</div>
</details>

## Database ERD
<img src="sources/salesyncdb.png">
ê° ì„œë¹„ìŠ¤ì˜ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë…¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆì–´, ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì˜ ë°ì´í„°ê°€ í•„ìš”í•œ ê²½ìš° ë‚´ë¶€ í†µì‹ ì„ í†µí•´ ì´ìš©í•œë‹¤.

## Kubernetes ë‚´ë¶€ API í†µì‹ 
<img src="sources/kubernetes_pods.png">
kubernetes ë‚´ë¶€ì—ì„œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì˜ podì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” "<service>.<namespace>.svc.cluster.local"ì£¼ì†Œë¡œ ì ‘ê·¼í•´ì•¼í•œë‹¤.

ì˜ˆì‹œ
```
http://service-item.default.svc.cluster.local
```

## Kafka ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬
<img src="sources/Kafka.png">
ì‚¬ìš©ìê°€ Consulting ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ ì¦‰ì‹œ req_idë¥¼ ë°˜í™˜í•œ í›„ ë¹„ë™ê¸°ë¡œ GPT APIë¥¼ í˜¸ì¶œí•œë‹¤. GPT APIê°€ ë°˜í™˜í•œ ê°’ì„ ë°›ì•„ producerê°€ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ë©´ Dashboard ì„œë¹„ìŠ¤ì˜ consumerê°€ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì´ë‹¤.
<img src="sources/kafka2.png">
ê°ê°ì˜ producerì™€ consumerì€ consulting í† í”½ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ì†¡ìˆ˜ì‹ í•œë‹¤.

consumerì—ì„œëŠ” ë©”ì‹œì§€ë¥¼ ë°›ì„ ë•Œ, íŒŒë¼ë¯¸í„°ë¡œ ë°›ì€ req_idì— í•´ë‹¹í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì„œì¹­í•˜ì—¬ ë°˜í™˜í•´ì¤€ë‹¤.

## Amazon SNS ì´ìš©í•œ ë¬¸ì ì „ì†¡
ì •ì‚°í•˜ê¸° ë²„íŠ¼ í´ë¦­ì‹œ í•´ë‹¹í•˜ëŠ” ë§¤ì¥ì˜ í•˜ë£¨ ë§¤ì¶œ ì •ë³´ë¥¼ ë¬¸ìë¡œ ì „ì†¡í•œë‹¤.
- ì„œìš¸ ë¦¬ì „ì—ì„œëŠ” Amazon SNS ë©”ì‹œì§€ ì„œë¹„ìŠ¤ê°€ ì•ˆë˜ì–´ ë„ì¿„ ë¦¬ì „ì—ì„œ ì‚¬ìš©
- ìƒŒë“œ ë°•ìŠ¤ í•´ì œ ì‹œ ëª¨ë“  ë²ˆí˜¸ë¡œ ë¬¸ì ì „ì†¡ ê°€ëŠ¥<br>
    -> í˜„ì¬ ì„œë¹„ìŠ¤ì—ì„œ ë”ë¯¸ ë°ì´í„°ê°€ ë§ì•„ ìƒŒë“œ ë°•ìŠ¤ í•´ì œ ëŒ€ì‹  íŠ¹ì • ë²ˆí˜¸ë¡œë§Œ ì „ì†¡ë˜ë„ë¡ í•˜ì˜€ë‹¤.

## Trouble Shooting
1. /dashboards/volumes GET ì„±ëŠ¥ 50%ì´ìƒ í–¥ìƒ
2. /orders/ POST, PUT request bodyì˜ cartì— ë¹ˆë°°ì—´ì¸ ê²½ìš° ì£¼ë¬¸ ë“±ë¡ í˜¹ì€ ìˆ˜ì • ì‹¤íŒ¨
=> ë¹ˆ ë°°ì—´ì¸ ê²½ìš° ê¸°ì¡´ ì£¼ë¬¸ì„ ì‚­ì œí•˜ë„ë¡ ìˆ˜ì •
3. Database ë¶„ë¦¬ ì‹œ ì„œë¹„ìŠ¤ê°„ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°’ ì…ë ¥<br>
ì˜ˆ) store ì„œë¹„ìŠ¤ì—ì„œ 10ë²ˆ ìŠ¤í† ì— í•´ë‹¹í•˜ëŠ” ì •ë³´ê°€ ì—†ëŠ”ë°, Item ì„œë¹„ìŠ¤ì— ë°ì´í„°ê°€ ì…ë ¥ë˜ëŠ” ê²½ìš°
=> ì°¸ì¡° ê´€ê³„ë¥¼ ëª…í™•íˆí•˜ì—¬ ì¡°íšŒ í›„ ë“±ë¡ë  ìˆ˜ ìˆë„ë¡ ìˆ˜ì • 
4. OpenAI sercret key ì´ìŠˆ
-> ì´ˆê¸° secret key ê°’ì´ í™˜ê²½ ë³€ìˆ˜ë¡œ ì§€ì •ë˜ì§€ ì•Šì•„ ê³„ì† Consulting pod CrashLoopBackError ë°œìƒ
=> key ê´€ë¦¬ë¥¼ ìœ„í•´ secret keyë¡œ keyë¥¼ ë“±ë¡í•œ í›„ build ì‹œ argë¡œ ì‹œí¬ë¦¿ê°’ì„ ë°›ì•„ì˜¨ í›„ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •
5. EFK ìŠ¤íƒ ì´ìš©í•œ ë¡œê·¸ ìˆ˜ì§‘ ì¤‘ ë¶€í•˜ ë°œìƒ
-> ë¡œê·¸ ìˆ˜ì§‘ ì‹œ fluentd conf íŒŒì¼ ë¬¸ì œë¡œ ëª¨ë“  ê³µë°±ì„ ìˆ˜ì§‘í•˜ì—¬ ë…¸ë“œ ë¶€í•˜ ë°œìƒ
<img src="sources/efkë¶€í•˜1.png">
<img src="sources/efk ë¶€í•˜2.png">
=> deploy_*default_*.logì˜ í˜•ì‹ì„ ê°€ì§„ ë¡œê·¸ë§Œ ìˆ˜ì§‘í•´ì˜¤ë„ë¡ ìˆ˜ì • í›„ í•´ê²°